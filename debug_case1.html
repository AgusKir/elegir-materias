<!DOCTYPE html>
<html>
<head><title>Debug Case 1</title></head>
<body>
    <h1>Debug Case 1</h1>
    <pre id="output"></pre>
    <script src="classes.js?v=10"></script>
    <script>
        let output = '';
        
        const allSubjects = [];
        for (let i = 3621; i <= 3680; i++) allSubjects.push(i);
        allSubjects.push(901, 902, 903, 904, 911, 912);
        
        const excluded = new Set([901, 902, 903, 904, 3667, 3671]);
        const completed = allSubjects.filter(id => !excluded.has(id));
        
        const plan = new PlanDeEstudios();
        plan.cargarMateriasDesdeTexto(listado, completed);
        plan.cargarNombresDesdeTexto(tabla_nombres);
        plan.calcularYGuardarLongitudes(1);  // Semester 1
        
        output += '=== Case 1: semester 1 (Primero) ===\n\n';
        output += `cuatrisMinimosBase: ${plan.cuatrisMinimosHastaRecibirse(1)}\n\n`;
        
        output += '3667:\n';
        const data3667 = plan.datos_materias[3667];
        output += `  valor_corchete: ${data3667.valor_corchete} (expected 2)\n`;
        output += `  cuatrimestre: ${data3667.cuatrimestre}\n\n`;
        
        // Manually calculate what should happen
        const caminoDesde = plan.encontrarCaminoMasSemestresDesde(3667);
        const caminoHasta = plan.encontrarCaminoMasSemestresHasta(3667);
        output += `Path from 3667: ${caminoDesde.join(' -> ')}\n`;
        output += `Path to 3667: ${caminoHasta.join(' -> ')}\n\n`;
        
        const index3671 = caminoDesde.indexOf(3671);
        const pathBefore3671 = caminoDesde.slice(0, index3671);
        output += `Path before 3671: ${pathBefore3671.join(' -> ')}\n`;
        
        const semestersBefore3671 = plan.contarSemestresEnCamino(pathBefore3671, true);
        output += `Semesters before 3671: ${semestersBefore3671}\n`;
        
        const absoluteSemesterBefore3671 = 1 + semestersBefore3671 - 1;
        output += `Absolute semester before 3671: ${absoluteSemesterBefore3671}\n`;
        output += `Is Primero: ${absoluteSemesterBefore3671 % 2 === 1}\n\n`;
        
        const semestresHasta = plan.contarSemestresEnCamino(caminoHasta, true) - 1;
        const semestresDesde = plan.contarSemestresEnCamino(caminoDesde, true) - 1;
        output += `cantMateriasAntes (before adjustment): ${semestresHasta}\n`;
        output += `cantMateriasDespues (before gap): ${semestresDesde}\n`;
        
        const before3671IsPrimero = (absoluteSemesterBefore3671 % 2 === 1);
        const semestresDesdeWithGap = semestresDesde + (before3671IsPrimero ? 1 : 0);
        output += `cantMateriasDespues (after gap): ${semestresDesdeWithGap}\n\n`;
        
        const totalPathSemesters = semestresHasta + plan.contarSemestresEnCamino(caminoDesde, true);
        const actualPathWithGap = totalPathSemesters + (before3671IsPrimero ? 1 : 0);
        output += `Total path length (with gap): ${actualPathWithGap}\n`;
        output += `cuatrisMinimosBase: 4\n`;
        output += `Adjusted cuatrisMinimos: ${Math.min(4, actualPathWithGap)}\n\n`;
        
        output += `Expected valorCorchete = 2\n`;
        output += `This means: cuatrisMinimos - (cantAntes + cantDespues) = 2\n`;
        output += `With cantAntes=0, cantDespues=3 (including gap): 4 - 3 = 1\n`;
        output += `With cantAntes=0, cantDespues=2 (no gap): 4 - 2 = 2\n`;
        output += `So we should NOT add the gap for semester 1!\n`;
        
        document.getElementById('output').textContent = output;
    </script>
</body>
</html>
