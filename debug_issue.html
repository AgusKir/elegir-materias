<!DOCTYPE html>
<html>
<head>
    <title>Debug Issue</title>
</head>
<body>
    <h1>Debug the issue calculation</h1>
    <pre id="output"></pre>
    
    <script src="classes.js"></script>
    <script>
        const allSubjectIds = [
            3621, 3622, 3623, 3624, 3625, 3626, 3627, 3628, 3629, 3630,
            3631, 3632, 3633, 3634, 3635, 3636, 3637, 3638, 3639, 3640,
            3641, 3642, 3643, 3644, 3645, 3646, 3647, 3648, 3649, 3650,
            3651, 3652, 3653, 3654, 3655, 3656, 3657, 3658, 3659, 3660,
            3661, 3662, 3663, 3664, 3665, 3666, 3668, 3669, 3670,
            3675, 3676, 3677, 3678, 3679, 3680,
            901, 902, 903, 904, 911, 912
        ];
        
        const notCompleted = [901, 902, 903, 904, 3667, 3671];
        const completedSubjects = allSubjectIds.filter(id => !notCompleted.includes(id));
        
        const plan = new PlanDeEstudios();
        plan.cargarMateriasDesdeTexto(listado, completedSubjects);
        plan.cargarNombresDesdeTexto(tabla_nombres);
        plan.calcularYGuardarLongitudes(1);
        
        let output = 'Detailed Calculation for 901:\n';
        output += '=============================\n\n';
        
        const id = 901;
        output += `Subject: ${id}\n`;
        output += `cuatrisMinimosBase: ${plan.cuatrisMinimosHastaRecibirse(1)}\n`;
        output += `Has 3671 in graph: ${plan.materias[3671] ? 'Yes' : 'No'}\n`;
        output += `${id} leads to 3671: ${plan.esAlcanzableDesde(id, 3671)}\n`;
        
        const cantMateriasAntes = plan.encontrarCaminoMasLargoHasta(id).length - 1;
        const cantMateriasDespues = plan.encontrarCaminoMasLargoDesde(id).length - 1;
        output += `cantMateriasAntes: ${cantMateriasAntes}\n`;
        output += `cantMateriasDespues: ${cantMateriasDespues}\n`;
        
        const tiene3671Adelante = plan.esAlcanzableDesde(id, 3671);
        let cuatrisMinimos = plan.cuatrisMinimosHastaRecibirse(1);
        if (plan.materias[3671] && !tiene3671Adelante) {
            cuatrisMinimos = plan.cuatrisMinimosHastaRecibirse(1) + 1;
        }
        output += `cuatrisMinimos (adjusted): ${cuatrisMinimos}\n`;
        output += `valor_corchete = ${cuatrisMinimos} - (${cantMateriasAntes} + ${cantMateriasDespues}) = ${cuatrisMinimos - (cantMateriasAntes + cantMateriasDespues)}\n`;
        output += `Actual valor_corchete: ${plan.datos_materias[id].valor_corchete}\n`;
        output += `Expected: 1\n\n`;
        
        output += '\nAnalysis:\n';
        output += '=========\n';
        output += 'The problem is that cuatrisMinimosBase is 4 (based on 901->902->903->904).\n';
        output += 'But the ACTUAL minimum semesters should account for 3671 taking 2 semesters.\n\n';
        output += 'Paths in the graph:\n';
        output += '1. 901 -> 902 -> 903 -> 904 (4 subjects = 4 semesters)\n';
        output += '2. 3667 -> 3671 (2 subjects but 3 semesters: 3667=1, 3671=2)\n\n';
        output += 'So the REAL minimum is max(4, 3) = 4 semesters.\n';
        output += 'But wait, 3671 can only start in Primero (odd semester).\n';
        output += 'If we\'re in Primero (semester 1):\n';
        output += '  - 3667 can be taken in semester 1 or 2\n';
        output += '  - 3671 must start in semester 3 (next Primero)\n';
        output += '  - 3671 ends in semester 4\n';
        output += '  - Total: 4 semesters\n\n';
        output += 'Since 901 does NOT lead to 3671, it gets +1, so cuatrisMinimos = 5.\n';
        output += 'valor_corchete = 5 - (0 + 3) = 2, but we expect 1.\n\n';
        output += 'The issue is that cuatrisMinimosBase should ALREADY include the +1 for 3671!\n';
        output += 'Currently: cuatrisMinimosBase = 4 (from path length)\n';
        output += 'Should be: cuatrisMinimosBase = 4 + 1 = 5 (accounting for 3671)\n';
        output += 'THEN subjects leading to 3671 should get -1 to compensate.\n';
        
        document.getElementById('output').textContent = output;
    </script>
</body>
</html>
