<!DOCTYPE html>
<html>
<head>
    <title>Debug Test Scenario</title>
</head>
<body>
    <h1>Debug test scenario</h1>
    <pre id="output"></pre>
    
    <script src="classes.js"></script>
    <script>
        const completedSubjects = [
            3621, 3622, 3623, 3624, 3625, 3626, 3627, 3628, 3629, 3630,
            3631, 3632, 3633, 3634, 3635, 3636, 3637, 3638, 3639, 3640,
            3642, 3643, 3645, 3649, 3651, 901, 902, 911, 912
        ];
        
        const plan = new PlanDeEstudios();
        plan.cargarMateriasDesdeTexto(listado, completedSubjects);
        plan.cargarNombresDesdeTexto(tabla_nombres);
        plan.calcularYGuardarLongitudes();
        
        let output = 'Test scenario debug (semester = null):\n';
        output += '======================================\n\n';
        
        output += 'cuatrisMinimosHastaRecibirse(null): ' + plan.cuatrisMinimosHastaRecibirse(null) + '\n';
        output += 'cuatrisMinimosHastaRecibirse(1): ' + plan.cuatrisMinimosHastaRecibirse(1) + '\n\n';
        
        output += 'Failing tests:\n';
        output += '3647: expected 2, actual ' + plan.datos_materias[3647].valor_corchete + '\n';
        output += '3648: expected 2, actual ' + plan.datos_materias[3648].valor_corchete + '\n';
        output += '3656: expected 3, actual ' + plan.datos_materias[3656].valor_corchete + '\n\n';
        
        // Check paths
        const camino3647 = plan.encontrarCaminoMasLargoDesde(3647);
        const camino3647Hasta = plan.encontrarCaminoMasLargoHasta(3647);
        output += '3647 path from: ' + camino3647.join('->') + '\n';
        output += '3647 path to: ' + camino3647Hasta.join('->') + '\n';
        output += '3647 cantMateriasDespues: ' + (plan.contarSemestresEnCamino(camino3647) - 1) + '\n';
        output += '3647 cantMateriasAntes: ' + (plan.contarSemestresEnCamino(camino3647Hasta) - 1) + '\n';
        
        const includes3671 = camino3647.includes(3671) || camino3647Hasta.includes(3671);
        output += '3647 involves 3671: ' + includes3671 + '\n\n';
        
        output += 'Analysis:\n';
        output += 'The issue is that when semester=null, we don\'t apply the parity adjustment,\n';
        output += 'so cuatrisMinimosBase is 4 instead of 5.\n';
        output += 'But the test expects values based on cuatrisMinimosBase = 4 WITHOUT the parity adjustment.\n';
        output += 'This is correct! The parity adjustment should only apply when semester is specified.\n\n';
        output += 'So the test scenario with semester=null should work as before.\n';
        output += 'But it\'s not working because contarSemestresEnCamino is adding +1 for 3671!\n';
        
        document.getElementById('output').textContent = output;
    </script>
</body>
</html>
