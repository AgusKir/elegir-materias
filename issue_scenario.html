<!DOCTYPE html>
<html>
<head>
    <title>Issue Scenario</title>
</head>
<body>
    <h1>Testing the issue scenario</h1>
    <pre id="output"></pre>
    
    <script src="classes.js"></script>
    <script>
        // Test setup from the issue:
        // "all but 901, 902, 903, 904, 3667, and 3671 selected, and selecting the semester as Primero"
        // This means these subjects are NOT completed (they are in the graph)
        const allSubjectIds = [
            3621, 3622, 3623, 3624, 3625, 3626, 3627, 3628, 3629, 3630,
            3631, 3632, 3633, 3634, 3635, 3636, 3637, 3638, 3639, 3640,
            3641, 3642, 3643, 3644, 3645, 3646, 3647, 3648, 3649, 3650,
            3651, 3652, 3653, 3654, 3655, 3656, 3657, 3658, 3659, 3660,
            3661, 3662, 3663, 3664, 3665, 3666, 3668, 3669, 3670,
            3675, 3676, 3677, 3678, 3679, 3680,
            901, 902, 903, 904, 911, 912
        ];
        
        const notCompleted = [901, 902, 903, 904, 3667, 3671];
        const completedSubjects = allSubjectIds.filter(id => !notCompleted.includes(id));
        
        const plan = new PlanDeEstudios();
        plan.cargarMateriasDesdeTexto(listado, completedSubjects);
        plan.cargarNombresDesdeTexto(tabla_nombres);
        
        // Debug info
        const longestPath = plan.encontrarCaminoMasLargo();
        let output = 'Issue Test Scenario\n';
        output += '===================\n\n';
        output += 'NOT COMPLETED (in graph): ' + notCompleted.join(', ') + '\n';
        output += 'Longest path: ' + longestPath.map(id => `${id}`).join(' -> ') + '\n';
        output += 'Longest path length: ' + longestPath.length + '\n\n';
        
        // Check if 3671 exists
        output += '3671 exists in graph: ' + (plan.materias[3671] ? 'Yes' : 'No') + '\n';
        if (plan.materias[3671]) {
            const pathTo3671 = plan.encontrarCaminoMasLargoHasta(3671);
            output += 'Path to 3671: ' + pathTo3671.map(id => `${id}`).join(' -> ') + '\n';
            output += 'Path to 3671 length: ' + pathTo3671.length + '\n';
            
            const pathFrom3671 = plan.encontrarCaminoMasLargoDesde(3671);
            output += 'Path from 3671: ' + pathFrom3671.map(id => `${id}`).join(' -> ') + '\n';
            output += 'Path from 3671 length: ' + pathFrom3671.length + '\n';
        }
        
        output += '\ncuatrisMinimosHastaRecibirse: ' + plan.cuatrisMinimosHastaRecibirse() + '\n\n';
        
        // Now calculate (semester = 1 = Primero)
        plan.calcularYGuardarLongitudes(1);
        
        output += 'After calculation:\n';
        output += '3671 valor_corchete: ' + (plan.datos_materias[3671] ? plan.datos_materias[3671].valor_corchete : 'N/A') + '\n';
        output += '3671 cuatrimestre: ' + (plan.datos_materias[3671] ? plan.datos_materias[3671].cuatrimestre : 'N/A') + '\n';
        output += '3667 valor_corchete: ' + (plan.datos_materias[3667] ? plan.datos_materias[3667].valor_corchete : 'N/A') + '\n';
        output += '3667 cuatrimestre: ' + (plan.datos_materias[3667] ? plan.datos_materias[3667].cuatrimestre : 'N/A') + '\n\n';
        
        // Check the issue expectations
        output += 'Issue Expectations:\n';
        output += '==================\n\n';
        
        output += 'Initial state (all unchecked):\n';
        output += '901 valor_corchete: ' + (plan.datos_materias[901] ? plan.datos_materias[901].valor_corchete : 'N/A') + ' (expected 1, got ' + (plan.datos_materias[901] ? plan.datos_materias[901].valor_corchete : 'N/A') + ')\n';
        output += '3667 valor_corchete: ' + (plan.datos_materias[3667] ? plan.datos_materias[3667].valor_corchete : 'N/A') + ' (expected 2, correct)\n\n';
        
        // Now check 901
        const plan2 = new PlanDeEstudios();
        plan2.cargarMateriasDesdeTexto(listado, [...completedSubjects, 901]);
        plan2.cargarNombresDesdeTexto(tabla_nombres);
        plan2.calcularYGuardarLongitudes(1);
        
        output += 'After checking 901:\n';
        output += '902 valor_corchete: ' + (plan2.datos_materias[902] ? plan2.datos_materias[902].valor_corchete : 'N/A') + ' (expected 2, correct)\n';
        output += '3667 valor_corchete: ' + (plan2.datos_materias[3667] ? plan2.datos_materias[3667].valor_corchete : 'N/A') + ' (expected 2, correct)\n\n';
        
        // Now check 902
        const plan3 = new PlanDeEstudios();
        plan3.cargarMateriasDesdeTexto(listado, [...completedSubjects, 901, 902]);
        plan3.cargarNombresDesdeTexto(tabla_nombres);
        plan3.calcularYGuardarLongitudes(1);
        
        output += 'After checking 901, 902:\n';
        output += '903 valor_corchete: ' + (plan3.datos_materias[903] ? plan3.datos_materias[903].valor_corchete : 'N/A') + ' (expected 3, got ' + (plan3.datos_materias[903] ? plan3.datos_materias[903].valor_corchete : 'N/A') + ')\n';
        output += '3667 valor_corchete: ' + (plan3.datos_materias[3667] ? plan3.datos_materias[3667].valor_corchete : 'N/A') + ' (expected 2, correct)\n\n';
        
        // Now check 903
        const plan4 = new PlanDeEstudios();
        plan4.cargarMateriasDesdeTexto(listado, [...completedSubjects, 901, 902, 903]);
        plan4.cargarNombresDesdeTexto(tabla_nombres);
        plan4.calcularYGuardarLongitudes(1);
        
        output += 'After checking 901, 902, 903:\n';
        output += '904 valor_corchete: ' + (plan4.datos_materias[904] ? plan4.datos_materias[904].valor_corchete : 'N/A') + ' (expected 4, got ' + (plan4.datos_materias[904] ? plan4.datos_materias[904].valor_corchete : 'N/A') + ')\n';
        output += '3667 valor_corchete: ' + (plan4.datos_materias[3667] ? plan4.datos_materias[3667].valor_corchete : 'N/A') + ' (expected 2, correct)\n\n';
        
        output += '\nAnalysis:\n';
        output += '=========\n';
        output += 'The issue states that with 3667 and 3671 remaining:\n';
        output += '- 3671 is two semesters long\n';
        output += '- 3671 can only start on Primero (first semester)\n';
        output += '- User needs to take 3667 on semester 1 or 2\n';
        output += '- Then 3671 on semesters 3 and 4\n';
        output += '- So minimum semesters to graduate = 4\n';
        output += '- The 900-series classes are NOT in the path to 3671\n';
        output += '- So they should account for the extra semester that 3671 takes\n\n';
        
        // Check path relationships
        output += '901 leads to 3671? ' + plan.esAlcanzableDesde(901, 3671) + '\n';
        output += '902 leads to 3671? ' + (plan2.materias[902] ? plan2.esAlcanzableDesde(902, 3671) : 'N/A') + '\n';
        output += '903 leads to 3671? ' + (plan3.materias[903] ? plan3.esAlcanzableDesde(903, 3671) : 'N/A') + '\n';
        output += '904 leads to 3671? ' + (plan4.materias[904] ? plan4.esAlcanzableDesde(904, 3671) : 'N/A') + '\n';
        output += '3667 leads to 3671? ' + plan.esAlcanzableDesde(3667, 3671) + '\n';
        
        document.getElementById('output').textContent = output;
    </script>
</body>
</html>
